// Backbone.Picky, v0.1.0
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/derickbailey/backbone.picky
Backbone.Picky=function(e,t){var n={};n.SingleSelect=function(){},n.SingleSelect.mixInto=function(e,r){var s=new n.SingleSelect;t.extend(e,s),r&&r.selectOnAdd&&e.on("add",function(e,t){t.select(e)}),r&&r.selectOnRemove?e.on("remove",function(e,n,i){var s=i.index,o=Math.max(s-1,0),u=Math.min(s,n.length-1);if(n.selected===e){if(t.isFunction(r.selectOnRemove)){r.selectOnRemove(e,n,i);return}if(n.length===0)return;if(r.selectOnRemove==="prev"){n.at(o).select();return}if(r.selectOnRemove==="next"){n.at(u).select();return}}}):e.on("remove",function(e,t){t.selected===e&&delete t.selected}),e.on("reset",function(e,t){t.refreshSelection()}),i(e)},t.extend(n.SingleSelect.prototype,{select:function(e){if(e&&this.selected===e)return;if(!this.some(function(t){return t===e}))return;this.deselect(),this.selected=e,this.selected.select(),this.trigger("collection:selected",e)},deselect:function(e){var t;if(!this.selected)return;e=e||this.selected;if(this.selected!==e)return;t=this.selected,delete this.selected,this.trigger("collection:deselected",t),t.deselect()},refreshSelection:function(){i(this)}}),n.MultiSelect=function(){},n.MultiSelect.mixInto=function(e,i){var o=new n.MultiSelect;o.selected={},t.extend(e,o),i&&i.selectOnAdd&&e.on("add",function(e,t){t.select(e)}),e.on("remove",function(e,t){t.selected&&t.selected.hasOwnProperty(e.cid)&&(delete t.selected[e.cid],r(t))}),e.on("reset",function(e,t){t.refreshSelection()}),s(e)},t.extend(n.MultiSelect.prototype,{select:function(e){if(this.selected[e.cid])return;if(!this.some(function(t){return t===e}))return;this.selected[e.cid]=e,e.select(),r(this)},deselect:function(e){if(!this.selected[e.cid])return;delete this.selected[e.cid],e.deselect(),r(this)},selectAll:function(){this.each(function(e){e.select()}),r(this)},deselectAll:function(){if(this.selectedLength===0)return;this.each(function(e){e.deselect()}),r(this)},toggleSelectAll:function(){this.selectedLength===this.length?this.deselectAll():this.selectAll()},refreshSelection:function(){s(this)},getSelected:function(){var e,t=[];for(e in this.selected)this.selected.hasOwnProperty(e)&&t.push(this.selected[e]);return t}}),n.Selectable=function(){},n.Selectable.mixInto=function(e){var r=new n.Selectable;t.extend(e,r)},t.extend(n.Selectable.prototype,{select:function(e){if(this.selected)return;this.collection&&t.isFunction(this.collection.select)&&this.collection.select(this),this.selected=!0;if(e&&e.silent)return;this.trigger("model:selected")},deselect:function(e){if(!this.selected)return;this.collection&&t.isFunction(this.collection.deselect)&&this.collection.deselect(this),this.selected=!1;if(e&&e.silent)return;this.trigger("model:deselected")},toggleSelected:function(e){this.selected?this.deselect(e):this.select(e)},changeSelected:function(e,t){e?this.select(t):this.deselect(t)}});var r=function(e){e.selectedLength=t.size(e.selected);var n=e.selectedLength,r=e.length;if(n===r){e.trigger("collection:selected:all",e);return}if(n===0){e.trigger("collection:selected:none",e);return}if(n>0&&n<r){e.trigger("collection:selected:some",e);return}},i=function(e){delete e.selected,e.each(function(t){t.selected&&(e.selected?t.deselect({silent:!0}):e.selected=t)}),e.selected&&e.trigger("collection:selected",e.selected)},s=function(e){e.selected={},e.each(function(t){t.selected&&(e.selected[t.cid]=t)}),r(e)};return n}(Backbone,_);