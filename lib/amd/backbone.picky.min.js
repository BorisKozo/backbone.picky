// Backbone.Picky, v0.2.1
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Copyright (c)2013 Boris Kozorovitzky.
// Distributed under MIT license
// http://github.com/BorisKozo/backbone.picky

Backbone.Picky=function(e,t){var c={};c.SingleSelect=function(){},c.SingleSelect.mixInto=function(e,l){var n=new c.SingleSelect;t.extend(e,n),l&&l.selectOnAdd&&e.on("add",function(e,t){t.select(e)}),l&&l.selectOnRemove?e.on("remove",function(e,c,i){var n=i.index,s=Math.max(n-1,0),o=Math.min(n,c.length-1);if(c.selected===e){if(t.isFunction(l.selectOnRemove))return l.selectOnRemove(e,c,i),void 0;if(0===c.length)return;if("prev"===l.selectOnRemove)return c.at(s).select(),void 0;if("next"===l.selectOnRemove)return c.at(o).select(),void 0}}):e.on("remove",function(e,t){t.selected===e&&delete t.selected}),e.on("reset",function(e){e.refreshSelection()}),i(e)},t.extend(c.SingleSelect.prototype,{select:function(e){e&&this.selected===e||this.some(function(t){return t===e})&&(this.deselect(),this.selected=e,this.selected.select(),this.trigger("collection:selected",e))},deselect:function(e){var t;this.selected&&(e=e||this.selected,this.selected===e&&(t=this.selected,delete this.selected,this.trigger("collection:deselected",t),t.deselect()))},refreshSelection:function(){i(this)}}),c.MultiSelect=function(){},c.MultiSelect.mixInto=function(e,i){var s=new c.MultiSelect;s.selected={},t.extend(e,s),i&&i.selectOnAdd&&e.on("add",function(e,t){t.select(e)}),e.on("remove",function(e,t){t.selected&&t.selected.hasOwnProperty(e.cid)&&(delete t.selected[e.cid],l(t))}),e.on("reset",function(e){e.refreshSelection()}),n(e)},t.extend(c.MultiSelect.prototype,{select:function(e){this.selected[e.cid]||this.some(function(t){return t===e})&&(this.selected[e.cid]=e,e.select(),l(this))},deselect:function(e){this.selected[e.cid]&&(delete this.selected[e.cid],e.deselect(),l(this))},selectAll:function(){this.each(function(e){e.select()}),l(this)},deselectAll:function(){0!==this.selectedLength&&(this.each(function(e){e.deselect()}),l(this))},toggleSelectAll:function(){this.selectedLength===this.length?this.deselectAll():this.selectAll()},refreshSelection:function(){n(this)},getSelected:function(){var e,t=[];for(e in this.selected)this.selected.hasOwnProperty(e)&&t.push(this.selected[e]);return t}}),c.Selectable=function(){},c.Selectable.mixInto=function(e){var l=new c.Selectable;t.extend(e,l)},t.extend(c.Selectable.prototype,{select:function(e){this.selected||(this.collection&&t.isFunction(this.collection.select)&&this.collection.select(this),this.selected=!0,e&&e.silent||this.trigger("model:selected"))},deselect:function(e){this.selected&&(this.collection&&t.isFunction(this.collection.deselect)&&this.collection.deselect(this),this.selected=!1,e&&e.silent||this.trigger("model:deselected"))},toggleSelected:function(e){this.selected?this.deselect(e):this.select(e)},changeSelected:function(e,t){e?this.select(t):this.deselect(t)}});var l=function(e){e.selectedLength=t.size(e.selected);var c=e.selectedLength,l=e.length;return c===l?(e.trigger("collection:selected:all",e),void 0):0===c?(e.trigger("collection:selected:none",e),void 0):c>0&&l>c?(e.trigger("collection:selected:some",e),void 0):void 0},i=function(e){delete e.selected,e.each(function(t){t.selected&&(e.selected?t.deselect({silent:!0}):e.selected=t)}),e.selected&&e.trigger("collection:selected",e.selected)},n=function(e){e.selected={},e.each(function(t){t.selected&&(e.selected[t.cid]=t)}),l(e)};return c}(Backbone,_);